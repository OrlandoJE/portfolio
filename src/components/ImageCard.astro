---
import { Image } from 'astro:assets';

interface Props {
  imagePath: string;
  altText: string;
  class?: string;
}

const { imagePath, altText, class: className } = Astro.props as Props;
// image path looks like "src/content/blog/blog-slug-1/img1.jpg"

const images = import.meta.glob<{ default: ImageMetadata }>(
  '/src/assets/**/**/**/*.{jpeg,jpg,png,gif,webp}',
);

if (!images[imagePath])
  throw new Error(
    `"${imagePath}" does not exist in glob: "/src/assets/**/**/*.{jpeg,jpg,png,gif,webp}". See ImageComponent.astro to debug.`,
  );
---

<Image
  src={images[imagePath]()}
  alt={altText}
  class={className}
  id={`open-${imagePath}`}
  data-dialog-id={`dialog-${imagePath}`}
/>

<dialog
  id={`dialog-${imagePath}`}
  class='backdrop:bg-black/80 bg-transparent rounded-md p-0 border-none m-auto'>
  <Image
    src={images[imagePath]()}
    alt={altText}
    class='object-contain max-h-[80vh] max-w-[80vw]'
  />
</dialog>

<script>
  const triggerImages = document.querySelectorAll('[data-dialog-id]');

  triggerImages.forEach((img) => {
    img.addEventListener('click', () => {
      const dialogId = img.getAttribute('data-dialog-id');

      if (dialogId) {
        const dialog = document.getElementById(dialogId) as HTMLDialogElement;
        dialog.showModal();
        dialog.addEventListener('click', () => dialog.close());
      }
    });
  });
</script>
